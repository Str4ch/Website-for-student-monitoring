select STUDENT_POPULATION_CODE_REF, STUDENT_POPULATION_YEAR_REF, STUDENT_POPULATION_PERIOD_REF, summ*100/count as percents from
(
SELECT STUDENT_POPULATION_CODE_REF, STUDENT_POPULATION_PERIOD_REF, STUDENT_POPULATION_YEAR_REF, sum(ATTENDANCE_PRESENCE) as summ, COUNT(*) as count
from(
SELECT a.ATTENDANCE_PRESENCE, ss.STUDENT_POPULATION_CODE_REF, ss.STUDENT_POPULATION_PERIOD_REF, ss.STUDENT_POPULATION_YEAR_REF   FROM ATTENDANCE as a
inner join  (select STUDENT_EPITA_EMAIL, STUDENT_POPULATION_CODE_REF, STUDENT_POPULATION_PERIOD_REF, STUDENT_POPULATION_YEAR_REF    from STUDENTS) as ss
where ss.STUDENT_EPITA_EMAIL = a.ATTENDANCE_STUDENT_REF )
group by STUDENT_POPULATION_CODE_REF, STUDENT_POPULATION_PERIOD_REF, STUDENT_POPULATION_YEAR_REF
)
ORDER BY percents desc