select CONTACT_EMAIL,  CONTACT_FIRST_NAME, CONTACT_LAST_NAME, COURSE_NAME ,  summm/couuunt as summ
from
(
select GRADE_STUDENT_EPITA_EMAIL_REF, GRADE_COURSE_CODE_REF,cn.COURSE_NAME, sum(GRADE_SCORE) as summm, count(GRADE_SCORE) as couuunt,  from GRADES
join (select COURSE_CODE, COURSE_NAME  from COURSES) as cn where cn.COURSE_CODE  = GRADE_COURSE_CODE_REF
group by GRADE_COURSE_CODE_REF, GRADE_STUDENT_EPITA_EMAIL_REF
order by GRADE_STUDENT_EPITA_EMAIL_REF
)
join STUDENTS on GRADE_STUDENT_EPITA_EMAIL_REF = STUDENT_EPITA_EMAIL
join CONTACTS on STUDENT_CONTACT_REF = CONTACT_EMAIL
where STUDENT_POPULATION_PERIOD_REF = '{period}' and STUDENT_POPULATION_YEAR_REF = {year} and STUDENT_POPULATION_CODE_REF = '{course}'